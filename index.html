<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì¹´ ë§ˆìŠ¤í„° - ìœ ì§€ë¹„ ë¶„ì„ê¸°</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #f5f5f7; }
        .card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1 { text-align: center; color: #1d1d1f; margin-bottom: 30px; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #86868b; font-size: 14px; font-weight: 600; }
        input, select { width: 100%; padding: 12px; border: 1px solid #d2d2d7; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        input:focus { outline: none; border-color: #0071e3; }
        
        button { width: 100%; padding: 16px; background: #0071e3; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 17px; margin-top: 10px; transition: background 0.2s; }
        button:hover { background: #0077ed; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        .price-tag { font-size: 32px; font-weight: 800; color: #1d1d1f; text-align: center; margin: 10px 0; }
        .detail-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .detail-row:last-child { border-bottom: none; }
        
        /* ì—°ë£Œ íƒ€ì… ë°°ì§€ ìŠ¤íƒ€ì¼ (ì‚¬ì´ì¦ˆ ì¡°ì ˆ) */
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 6px; vertical-align: middle; }
        .badge-premium { background: #ffebeb; color: #d63031; border: 1px solid #ffcccc; } /* ê³ ê¸‰ìœ  */
        .badge-regular { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; } /* ì¼ë°˜ìœ  */

        .risk-box { background: #fff5f5; border: 1px solid #ffcccc; color: #d63031; padding: 15px; border-radius: 8px; font-size: 14px; line-height: 1.5; }
        .item-list { list-style: none; padding: 0; }
        .item-list li { background: #f9f9f9; padding: 12px; margin-bottom: 8px; border-radius: 8px; font-size: 14px; }
        .loading { text-align: center; display: none; padding: 20px; }
    </style>
</head>
<body>

    <h1>ğŸš— ë‚´ ì°¨ ìœ ì§€ë¹„ ì–¼ë§ˆì¼ê¹Œ?</h1>
    
    <div class="card">
        <div class="input-group">
            <label>ì°¨ëŸ‰ ëª¨ë¸ëª…</label>
            <input type="text" id="carModel" placeholder="ì˜ˆ: BMW 530i, ì œë„¤ì‹œìŠ¤ G70">
        </div>
        <div class="input-group">
            <label>ì°¨ëŸ‰ ì—°ì‹</label>
            <input type="number" id="carYear" placeholder="2023" value="2023">
        </div>
        <div style="display: flex; gap: 10px;">
            <div class="input-group" style="flex: 1;">
                <label>ì¶œìƒë…„ë„</label>
                <input type="number" id="birthYear" placeholder="1995" value="1995">
            </div>
            <div class="input-group" style="flex: 1;">
                <label>ìš´ì „ ê²½ë ¥</label>
                <select id="drivingExp">
                    <option value="0">ì‹ ê·œ (0ë…„)</option>
                    <option value="1">1~2ë…„</option>
                    <option value="3">3ë…„ ì´ìƒ</option>
                </select>
            </div>
        </div>
        <button onclick="calculate()">ğŸ’° AI ì •ë°€ ìœ ì§€ë¹„ ë¶„ì„ ì‹œì‘</button>
    </div>

    <div id="loading" class="loading">
        <p>AI ëª…ì¥ì´ ê³ ê°ë‹˜ì˜ ì¡°ê±´ê³¼ ì°¨ëŸ‰ ë°ì´í„°ë¥¼<br>ì •ë°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...ğŸ•µï¸â€â™‚ï¸</p>
    </div>

    <div id="result" style="display:none;">
        <div class="card" style="border: 2px solid #0071e3; background: #f0f7ff;">
            <div style="text-align: center;">
                <span style="font-size: 14px; color: #0071e3; font-weight: bold;">ì›” ì˜ˆìƒ ìœ ì§€ë¹„</span>
                <div class="price-tag" id="monthlyTotal">0ì›</div>
                <span style="font-size: 13px; color: #666;">(í• ë¶€ê¸ˆ ì œì™¸ ìˆœìˆ˜ ìœ ì§€ë¹„)</span>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ“Š 1ë…„ ìƒì„¸ ì§€ì¶œ ëª…ì„¸ì„œ</h3>
            <div class="detail-row">
                <span>â›½ ì—°ê°„ ì£¼ìœ ë¹„ <span id="fuelBadge"></span></span>
                <span id="fuelCost" style="font-weight:bold;">0ì›</span>
            </div>
            <div class="detail-row">
                <span>ğŸ› ìë™ì°¨ì„¸ (í• ì¸ì ìš©)</span>
                <span id="taxCost" style="font-weight:bold;">0ì›</span>
            </div>
            <div class="detail-row">
                <span>ğŸ›¡ ìë™ì°¨ ë³´í—˜ë£Œ(ì˜ˆìƒ)</span>
                <span id="insCost" style="font-weight:bold; color: #0071e3;">0ì›</span>
            </div>
            <div class="detail-row">
                <span>ğŸ”§ ì •ë¹„ ì˜ˆë¹„ë¹„</span>
                <span id="repairCost" style="font-weight:bold;">0ì›</span>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ”© ì£¼ìš” ì†Œëª¨í’ˆ êµì²´ ë¹„ìš©</h3>
            <ul id="maintenanceList" class="item-list"></ul>
        </div>

        <div class="card">
            <h3>âš ï¸ êµ¬ë§¤ ì „ í•„ë… (ê³ ì§ˆë³‘)</h3>
            <div id="riskBox" class="risk-box"></div>
            <p id="aiComment" style="margin-top:15px; font-size:14px; color:#555; font-style:italic; line-height: 1.5;"></p>
        </div>
    </div>

    <script>
        async function calculate() {
            const btn = document.querySelector('button');
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';

            const carModel = document.getElementById('carModel').value;
            const carYear = document.getElementById('carYear').value;
            const birthYear = document.getElementById('birthYear').value;
            const drivingExp = document.getElementById('drivingExp').value;

            // [ì¤‘ìš”] ë³¸ì¸ì˜ n8n Webhook URLë¡œ êµì²´í•˜ì„¸ìš”!
            const webhookUrl = 'https://bot.hopto.org/webhook/car-cost-calc'; 

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        car_model: carModel, 
                        car_year: parseInt(carYear),
                        birth_year: parseInt(birthYear), 
                        driving_exp: drivingExp
                    })
                });

                const data = await response.json();
                const fmt = (n) => parseInt(n).toLocaleString() + 'ì›';

                // ë°ì´í„° ë°”ì¸ë”©
                document.getElementById('monthlyTotal').innerText = fmt(data.calculated.total_monthly);
                document.getElementById('fuelCost').innerText = fmt(data.yearly_costs.fuel_20k);
                document.getElementById('taxCost').innerText = fmt(data.calculated.tax_year);
                document.getElementById('insCost').innerText = fmt(data.yearly_costs.insurance);
                document.getElementById('repairCost').innerText = fmt(data.yearly_costs.repair_fund);

                // --- [ìˆ˜ì •ë¨] ë°°ì§€ ìœ„ì¹˜ ë³€ê²½ (ì£¼ìœ ë¹„ ì˜†ìœ¼ë¡œ ì´ë™) ---
                const badgeSpan = document.getElementById('fuelBadge');
                const fuelGrade = data.specs.fuel_grade || "ì¼ë°˜ìœ "; 
                
                if(fuelGrade.includes("ê³ ê¸‰") || fuelGrade.includes("Premium")) {
                    badgeSpan.innerHTML = `<span class="badge badge-premium">ğŸ”¥ê³ ê¸‰ìœ </span>`;
                } else {
                    badgeSpan.innerHTML = `<span class="badge badge-regular">ğŸ’§ì¼ë°˜ìœ </span>`;
                }
                // ------------------------------------------------

                const list = document.getElementById('maintenanceList');
                list.innerHTML = '';
                if(data.maintenance_items) {
                    data.maintenance_items.forEach(item => {
                        list.innerHTML += `<li>
                            <div style="display:flex; justify-content:space-between;">
                                <strong>${item.part}</strong>
                                <span>${fmt(item.cost)}</span>
                            </div>
                            <div style="font-size:12px; color:#888; margin-top:2px;">ğŸ”„ ${item.cycle}</div>
                        </li>`;
                    });
                }

                document.getElementById('riskBox').innerText = data.risk_report;
                document.getElementById('aiComment').innerText = `ğŸ’¡ "${data.total_comment}"`;

                result.style.display = 'block';

            } catch (error) {
                alert('ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error(error);
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
